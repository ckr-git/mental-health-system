# ç™»å½•é—®é¢˜å®Œæ•´è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜è¯Šæ–­ç»“æœ

### âœ… å·²ç¡®è®¤æ­£å¸¸çš„éƒ¨åˆ†
1. âœ… åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸ï¼ˆç«¯å£8080ï¼‰
2. âœ… å‰ç«¯æœåŠ¡è¿è¡Œæ­£å¸¸ï¼ˆç«¯å£3000ï¼‰
3. âœ… æ•°æ®åº“è´¦å·å­˜åœ¨ä¸”å¯†ç æ ¼å¼æ­£ç¡®
4. âœ… ç™»å½•APIå¯ä»¥è®¿é—®ï¼ˆè¿”å›200çŠ¶æ€ç ï¼‰

### âŒ å‘ç°çš„é—®é¢˜
**ç™»å½•APIè¿”å›500é”™è¯¯**
```json
{
  "code": 500,
  "message": "å†…éƒ¨é”™è¯¯ï¼ˆç¼–ç é—®é¢˜ï¼‰",
  "data": null
}
```

---

## ğŸš€ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæŸ¥çœ‹åç«¯æ—¥å¿—ï¼ˆæœ€é‡è¦ï¼‰

**è¯·ç«‹å³æŸ¥çœ‹åç«¯æ§åˆ¶å°**ï¼Œåº”è¯¥ä¼šçœ‹åˆ°è¯¦ç»†çš„é”™è¯¯å †æ ˆä¿¡æ¯ã€‚

å¸¸è§é”™è¯¯å¯èƒ½æ˜¯ï¼š
- JWT Secret é…ç½®é—®é¢˜
- æ•°æ®åº“è¿æ¥é—®é¢˜
- MyBatis Mapper é—®é¢˜
- ç©ºæŒ‡é’ˆå¼‚å¸¸

---

### æ–¹æ¡ˆ2ï¼šæ£€æŸ¥å…³é”®é…ç½®

#### 1. æ£€æŸ¥ application.yml

æ‰“å¼€ `src/main/resources/application.yml`ï¼Œç¡®è®¤ï¼š

```yaml
# JWTé…ç½®
jwt:
  secret: mental-health-system-secret-key-2024  # è‡³å°‘32ä¸ªå­—ç¬¦
  expiration: 86400  # 24å°æ—¶ï¼ˆç§’ï¼‰

# æ•°æ®åº“é…ç½®
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mental_health?...
    username: root
    password: root123456  # ä½ çš„å¯†ç 
```

**é‡è¦**ï¼š`jwt.secret` å¿…é¡»è‡³å°‘32ä¸ªå­—ç¬¦é•¿ï¼

#### 2. é‡å¯åç«¯æœåŠ¡

ä¿®æ”¹é…ç½®åå¿…é¡»é‡å¯ï¼š
1. åœæ­¢åç«¯ï¼ˆCtrl+Cï¼‰
2. é‡æ–°è¿è¡Œï¼š`mvn spring-boot:run`

---

### æ–¹æ¡ˆ3ï¼šè®¿é—®æ­£ç¡®çš„å‰ç«¯åœ°å€

**âŒ é”™è¯¯**ï¼šhttp://localhost:5173  
**âœ… æ­£ç¡®**ï¼šhttp://localhost:3000

#### ä¸ºä»€ä¹ˆï¼Ÿ

vite.config.ts é…ç½®çš„æ˜¯3000ç«¯å£ï¼š
```typescript
server: {
  port: 3000,  // â† è¿™é‡Œ
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true
    }
  }
}
```

#### å¦‚ä½•ä¿®æ”¹ï¼ˆå¯é€‰ï¼‰

å¦‚æœæƒ³ä½¿ç”¨5173ç«¯å£ï¼Œä¿®æ”¹ `frontend/vite.config.ts`ï¼š

```typescript
server: {
  port: 5173,  // æ”¹ä¸º5173
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true
    }
  }
}
```

ç„¶åé‡å¯å‰ç«¯ã€‚

---

### æ–¹æ¡ˆ4ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. å³é”®ç‚¹å‡»åˆ·æ–°æŒ‰é’®
3. é€‰æ‹©"æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"

æˆ–ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•ã€‚

---

## ğŸ“‹ å®Œæ•´æ“ä½œæ­¥éª¤

### Step 1: æŸ¥çœ‹åç«¯æ—¥å¿—

åœ¨è¿è¡Œåç«¯çš„æ§åˆ¶å°çª—å£ä¸­ï¼ŒæŸ¥æ‰¾åŒ…å«ä»¥ä¸‹å…³é”®è¯çš„é”™è¯¯ï¼š
- `Exception`
- `Error`
- `Failed`
- `NullPointerException`

**å°†å®Œæ•´çš„é”™è¯¯ä¿¡æ¯å¤åˆ¶å‡ºæ¥**ï¼Œè¿™æ˜¯è¯Šæ–­çš„å…³é”®ï¼

### Step 2: ç¡®è®¤JWTé…ç½®

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥é…ç½®ï¼š

```powershell
cd "E:\ddd\æ™ºèƒ½å¿ƒé‡Œå¥åº·ç®¡ç†ç³»ç»Ÿ"
findstr /n "jwt" src\main\resources\application.yml
```

åº”è¯¥çœ‹åˆ°ï¼š
```
jwt:
  secret: mental-health-system-secret-key-2024
  expiration: 86400
```

### Step 3: æµ‹è¯•æ•°æ®åº“è¿æ¥

```powershell
mysql -u root -p'root123456' mental_health -e "SELECT username, role FROM user WHERE username='patient001'"
```

åº”è¯¥çœ‹åˆ°ï¼š
```
username     role
patient001   PATIENT
```

### Step 4: è®¿é—®æ­£ç¡®çš„URL

```
http://localhost:3000
```

### Step 5: ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·

1. æ‰“å¼€ http://localhost:3000
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° **Network** æ ‡ç­¾
4. å°è¯•ç™»å½•ï¼ˆpatient001 / 123456ï¼‰
5. ç‚¹å‡» `login` è¯·æ±‚
6. æŸ¥çœ‹ï¼š
   - **Headers** - è¯·æ±‚URLå’Œæ–¹æ³•
   - **Payload** - å‘é€çš„æ•°æ®
   - **Response** - æœåŠ¡å™¨è¿”å›çš„æ•°æ®

**æˆªå›¾æˆ–å¤åˆ¶ Response å†…å®¹**ï¼Œè¿™ä¼šå‘Šè¯‰æˆ‘ä»¬å…·ä½“é”™è¯¯ã€‚

---

## ğŸ”§ å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1ï¼šJWT Secret too short

**ç—‡çŠ¶**ï¼š
```
The specified key byte array is 24 bits which is not secure enough
```

**è§£å†³**ï¼š
ä¿®æ”¹ application.yml ä¸­çš„ jwt.secret ä¸ºè‡³å°‘32ä¸ªå­—ç¬¦ï¼š
```yaml
jwt:
  secret: mental-health-system-secret-key-2024-long-enough
```

### é”™è¯¯2ï¼šNullPointerException in getUserInfo

**ç—‡çŠ¶**ï¼š
```
NullPointerException at AuthService.getUserInfo
```

**è§£å†³**ï¼š
æ•°æ®åº“å­—æ®µä¸ºNULLå¯¼è‡´ã€‚å·²ç»åœ¨ä»£ç ä¸­ä½¿ç”¨äº†å®‰å…¨çš„æ–¹å¼ï¼Œä½†å¦‚æœä»å‡ºç°ï¼Œæ£€æŸ¥æ•°æ®åº“ï¼š
```sql
SELECT * FROM user WHERE username='patient001';
```

### é”™è¯¯3ï¼šPasswordEncoderæ— æ³•åŒ¹é…

**ç—‡çŠ¶**ï¼š
è¿”å›"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"ï¼Œä½†ç¡®å®šå¯†ç æ­£ç¡®

**è§£å†³**ï¼š
é‡æ–°æ›´æ–°å¯†ç å“ˆå¸Œï¼ˆå·²å®Œæˆï¼‰ã€‚

### é”™è¯¯4ï¼šMapper not found

**ç—‡çŠ¶**ï¼š
```
Error creating bean with name 'userMapper'
```

**è§£å†³**ï¼š
æ£€æŸ¥ MyBatis-Plus é…ç½®å’Œ Mapper æ‰«æè·¯å¾„ã€‚

---

## ğŸ§ª æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

### æµ‹è¯•1ï¼šç›´æ¥æµ‹è¯•API

è¿è¡Œï¼š
```powershell
cd "E:\ddd\æ™ºèƒ½å¿ƒé‡Œå¥åº·ç®¡ç†ç³»ç»Ÿ"
powershell -ExecutionPolicy Bypass -File test-api.ps1
```

å¦‚æœçœ‹åˆ° SUCCESS å’Œ tokenï¼Œè¯´æ˜åç«¯æ­£å¸¸ã€‚

### æµ‹è¯•2ï¼šä½¿ç”¨curlï¼ˆå¦‚æœæœ‰ï¼‰

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d "{\"username\":\"patient001\",\"password\":\"123456\"}"
```

### æµ‹è¯•3ï¼šæµè§ˆå™¨Consoleæµ‹è¯•

æ‰“å¼€ http://localhost:3000ï¼ŒæŒ‰F12ï¼Œåœ¨Consoleä¸­è¾“å…¥ï¼š

```javascript
fetch('/api/auth/login', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({username:'patient001', password:'123456'})
})
.then(r => r.json())
.then(data => {
  console.log('ç™»å½•ç»“æœ:', data);
  if (data.code === 200) {
    console.log('âœ“ ç™»å½•æˆåŠŸï¼');
    console.log('Token:', data.data.token);
  } else {
    console.log('âœ— ç™»å½•å¤±è´¥:', data.message);
  }
})
```

---

## ğŸ“ ä¸‹ä¸€æ­¥

**è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œå¹¶åé¦ˆç»“æœï¼š**

1. **æŸ¥çœ‹åç«¯æ§åˆ¶å°** - æ‰¾åˆ°500é”™è¯¯çš„è¯¦ç»†å †æ ˆä¿¡æ¯
2. **è®¿é—®æ­£ç¡®çš„URL** - http://localhost:3000ï¼ˆä¸æ˜¯5173ï¼‰
3. **ä½¿ç”¨F12å¼€å‘è€…å·¥å…·** - æŸ¥çœ‹Networkä¸­çš„loginè¯·æ±‚è¯¦æƒ…
4. **æä¾›é”™è¯¯ä¿¡æ¯** - å°†é”™è¯¯æˆªå›¾æˆ–æ–‡å­—å‘ç»™æˆ‘

æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæˆ‘å°±èƒ½ç²¾ç¡®å®šä½é—®é¢˜å¹¶æä¾›è§£å†³æ–¹æ¡ˆï¼

---

## ğŸ“ å¿«é€Ÿå‚è€ƒ

### æµ‹è¯•è´¦å·
- ç”¨æˆ·åï¼š`patient001`
- å¯†ç ï¼š`123456`
- è§’è‰²ï¼šæ‚£è€…

### å…³é”®ç«¯å£
- åç«¯ï¼š8080
- å‰ç«¯ï¼š3000ï¼ˆé…ç½®çš„ç«¯å£ï¼‰
- MySQLï¼š3306
- Redisï¼š6379

### å…³é”®æ–‡ä»¶
- åç«¯é…ç½®ï¼š`src/main/resources/application.yml`
- å‰ç«¯é…ç½®ï¼š`frontend/vite.config.ts`
- JWTå·¥å…·ï¼š`src/main/java/com/mental/health/common/JwtUtil.java`
- è®¤è¯æœåŠ¡ï¼š`src/main/java/com/mental/health/service/AuthService.java`
