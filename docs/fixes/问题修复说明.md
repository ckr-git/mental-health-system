# 🔧 问题修复说明

本文档说明了针对用户反馈的三个问题的修复情况。

---

## ❌ 问题1：favicon.ico 404错误

### 问题描述
```
favicon.ico:1 Failed to load resource: the server responded with a status of 404 (Not Found)
```

### 原因分析
前端项目缺少 `public` 目录和 `favicon.ico` 文件。

### 解决方案
✅ 已创建 `frontend/public/favicon.ico` 文件  
✅ 已在 `index.html` 中正确引用

### 验证方法
重启前端服务后，刷新页面不再出现 favicon 404 错误。

---

## ❌ 问题2：登录失败 - 用户名或密码错误

### 问题描述
```
Login.vue:64 Login failed: Error: 用户名或密码错误
```

### 原因分析
1. 数据库中没有测试账号
2. 用户注册后，密码经过BCrypt加密，但不知道如何创建测试数据

### 解决方案
✅ 已创建 `create-test-accounts.sql` 脚本，包含6个测试账号：
- 3个患者账号
- 2个医生账号
- 1个管理员账号

✅ 所有账号密码统一为：`123456`

### 使用方法

#### 方法1：MySQL命令行导入
```bash
mysql -u root -p mental_health < create-test-accounts.sql
```

#### 方法2：MySQL客户端执行
```sql
source E:/ddd/智能心里健康管理系统/create-test-accounts.sql;
```

#### 方法3：使用Navicat等工具
1. 打开 `create-test-accounts.sql` 文件
2. 复制所有SQL语句
3. 在查询窗口执行

### 测试账号列表

| 用户名 | 密码 | 角色 | 手机号 | 说明 |
|--------|------|------|--------|------|
| patient001 | 123456 | 患者 | 13800000001 | 有症状记录 |
| patient002 | 123456 | 患者 | 13800000002 | 空白账号 |
| patient003 | 123456 | 患者 | 13800000003 | 空白账号 |
| doctor001 | 123456 | 医生 | 13900000001 | 赵医生 |
| doctor002 | 123456 | 医生 | 13900000002 | 钱医生 |
| admin | 123456 | 管理员 | 13700000001 | 系统管理员 |

### 验证方法
使用任意账号（例如 `patient001` / `123456`）登录，应该可以成功。

---

## ❌ 问题3：AI聊天超时错误

### 问题描述
```
request.ts:48 Response error: AxiosError {message: 'timeout of 15000ms exceeded', ...}
AIChat.vue:116 AI chat failed: AxiosError {message: 'timeout of 15000ms exceeded', ...}
```

### 原因分析
1. AI API配置中使用的是占位符 `your-ai-api-key`，不是真实的API密钥
2. 调用OpenAI API需要：
   - 有效的API Key（需要付费）
   - 能访问国外服务器（需要代理）
   - 等待时间较长（可能超过15秒）

### 解决方案
✅ **已添加Mock模式**，无需真实API即可体验AI功能

#### 修改内容

**1. AIService.java 增强**
- 添加 `mockEnabled` 配置项
- 实现 `generateMockResponse()` 方法
- 根据关键词返回智能响应：
  - 焦虑相关问题
  - 抑郁相关问题
  - 失眠相关问题
  - 压力相关问题
  - 通用心理健康建议

**2. application.yml 配置**
```yaml
ai:
  mock:
    enabled: true  # 开启Mock模式
  api:
    key: your-ai-api-key
    url: https://api.openai.com/v1/chat/completions
```

#### Mock响应特点
- ✅ **即时响应**：无需等待，立即返回结果
- ✅ **智能匹配**：根据问题关键词返回专业建议
- ✅ **专业内容**：包含实用的心理健康指导
- ✅ **支持中英文**：检测中英文关键词

#### 测试示例

**测试焦虑问题**
```
用户：我最近感觉很焦虑，总是紧张
AI：我理解您目前感到焦虑和紧张。首先，请您深呼吸，放松身体...
（返回焦虑缓解建议）
```

**测试抑郁问题**
```
用户：我感觉很沮丧，什么都不想做
AI：我听到了您的感受，感到沮丧和悲伤是很艰难的体验...
（返回抑郁应对建议）
```

**测试睡眠问题**
```
用户：我最近失眠很严重
AI：睡眠问题会严重影响生活质量和心理健康...
（返回睡眠改善建议）
```

### 如何启用真实AI API

如果您想使用真实的AI API（ChatGPT/通义千问等）：

**步骤1：获取API Key**
- OpenAI: https://platform.openai.com/api-keys
- 通义千问: https://dashscope.aliyun.com/

**步骤2：修改配置**
```yaml
ai:
  mock:
    enabled: false  # 关闭Mock模式
  api:
    key: sk-xxx  # 填入真实API Key
    url: https://api.openai.com/v1/chat/completions  # 或通义千问URL
```

**步骤3：重启后端服务**

### 验证方法
1. 使用患者账号登录
2. 进入"AI咨询"页面
3. 发送任意消息（例如："我很焦虑"）
4. 应在1-2秒内收到专业回复

---

## 🎯 修复总结

| 问题 | 状态 | 优先级 | 影响范围 |
|------|------|--------|----------|
| favicon 404 | ✅ 已修复 | 低 | 浏览器控制台警告 |
| 登录失败 | ✅ 已修复 | 高 | 阻塞所有功能 |
| AI超时 | ✅ 已修复 | 高 | 阻塞AI功能 |

---

## 🚀 重启步骤

修复完成后，请按以下步骤重启服务：

### 后端重启
```bash
# 停止当前后端服务（Ctrl+C）

# 重新启动
mvn spring-boot:run
```

或在IDE中重新运行 `MentalHealthApplication`。

### 前端重启
```bash
# 停止当前前端服务（Ctrl+C）

# 重新启动
cd frontend
npm run dev
```

### 导入测试账号
```bash
mysql -u root -p mental_health < create-test-accounts.sql
```

---

## ✅ 完整测试流程

### 1. 测试登录功能
- [ ] 使用 `patient001` / `123456` 登录成功
- [ ] 使用 `doctor001` / `123456` 登录成功
- [ ] 使用 `admin` / `123456` 登录成功

### 2. 测试患者功能
- [ ] 查看Dashboard数据
- [ ] 查看症状记录（patient001有3条记录）
- [ ] 添加新的症状记录
- [ ] 进入AI咨询页面
- [ ] 发送消息：「我最近很焦虑」
- [ ] 1-2秒内收到AI回复
- [ ] 尝试不同关键词：「失眠」、「压力」、「抑郁」
- [ ] 浏览心理资源
- [ ] 查看医生列表

### 3. 测试医生功能
- [ ] 查看患者列表
- [ ] 查看patient001的症状记录
- [ ] 创建评估报告

### 4. 测试管理员功能
- [ ] 查看用户统计数据
- [ ] 管理用户列表

---

## 📚 相关文档

- `create-test-accounts.sql` - 测试账号导入脚本
- `测试账号说明.md` - 测试账号详细说明
- `README.md` - 项目完整文档
- `使用指南.md` - 快速启动指南

---

## 🆘 常见问题

### Q1: 导入测试账号时报错"主键冲突"
**A**: 数据库中已存在这些账号，执行清理SQL后重新导入：
```sql
DELETE FROM user WHERE username IN ('patient001', 'patient002', 'patient003', 'doctor001', 'doctor002', 'admin');
```

### Q2: AI功能还是超时
**A**: 检查后端日志，确认Mock模式已启用。查看 application.yml 中 `ai.mock.enabled` 是否为 `true`。

### Q3: 登录后页面空白
**A**: 检查浏览器控制台是否有其他错误，可能是路由配置问题。

### Q4: 如何切换到真实AI API
**A**: 修改 `application.yml` 中的配置：
```yaml
ai:
  mock:
    enabled: false  # 改为false
  api:
    key: 你的真实API-Key  # 填入真实Key
```

---

## 📞 技术支持

如果还有其他问题，请提供：
1. 浏览器控制台的完整错误信息
2. 后端日志输出
3. 操作步骤描述

这样可以更快速地定位和解决问题。
